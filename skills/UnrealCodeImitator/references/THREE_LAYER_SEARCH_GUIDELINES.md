# 三层搜索充分信息收集指南

> **版本：** 1.0  
> **目的：** 规范 Skill 在解决问题前的信息收集流程  
> **更新日期：** 2025-11-14

---

## 核心原则

### 不再有"快速查询"例外

**原则变更：**
- ❌ 旧：如果第一层（@UE5）有清晰答案，可以跳过后续搜索
- ✅ 新：**默认执行全部三层搜索，除非问题极简或极确定**

**理由：**
1. 三层搜索提供**不同维度**的信息
   - @UE5：官方权威、最新最佳实践
   - 网络：社区验证、实用技巧、多角度方案
   - 源码：底层实现、设计模式、优化细节

2. **信息互补性**强
   - 官方可能只给出 API 说明，不一定有实现技巧
   - 社区方案可能比官方更新或更实用
   - 源码实现细节官方文档中找不到

3. **问题解决更全面**
   - 三层信息齐全 → 解决方案更完整
   - 只用一层信息 → 可能遗漏最佳实践

---

## 三层搜索详解

### 第一层：@UE5 官方知识库

**目标：** 获取官方权威信息

**搜索范围：**
- 官方 API 文档和函数说明
- 推荐的实现方式
- 官方示例代码
- 已知的最佳实践
- 新版本特性说明

**执行方式：**
```python
RAG_search(
    queryString="[转化后的关键词]",
    knowledgeBaseNames="UE5"
)
```

**预期收获：**
- 官方推荐的做法
- 完整的 API 文档
- 代码示例（如有）
- 版本兼容性说明

**评估标准：**
- ✅ 充分：有清晰的官方推荐、代码示例、文档
- ⚠️ 部分：只有概括说明，缺少细节或示例
- ❌ 不足：没找到相关信息或信息不完整

---

### 第二层：网络搜索

**目标：** 获取社区方案和最新技巧

**搜索范围：**
- 官方教程和文档（最新版本）
- 社区文章和博客
- GitHub 项目参考
- Stack Overflow 讨论
- 最佳实践总结
- 性能优化技巧
- 常见问题解决

**执行方式：**
```python
mcp_call_tool(
    serverName="ddg-search",
    toolName="search",
    arguments=json.dumps({
        "query": "[功能名] [关键词] [Unreal/UE5] [教程/实现/最佳实践]",
        "max_results": 10
    })
)
```

**搜索策略示例：**

| 问题类型 | 搜索关键词 | 预期结果 |
|---------|----------|--------|
| 学习实现 | "Unreal Engine [功能] tutorial" | 教程、实现步骤 |
| 性能优化 | "Unreal [系统] performance optimization" | 优化技巧 |
| 问题解决 | "Unreal [问题] solution" | 社区解决方案 |
| 最佳实践 | "Unreal [功能] best practices 2024" | 最新社区实践 |

**预期收获：**
- 多个不同的实现方案
- 社区验证的方法
- 性能优化建议
- 常见错误和解决方法
- 最新的工具或技巧

**评估标准：**
- ✅ 充分：多个高质量资源、有最新信息、不同角度方案
- ⚠️ 部分：1-2 个可用资源、信息有限
- ❌ 不足：没有相关资源或都是过时信息

---

### 第三层：源码分析

**目标：** 获取实现细节和设计模式

**搜索范围：**
- 源码中的关键类和函数定义
- 实现逻辑和代码流程
- 设计模式（工厂、观察者、单例等）
- 内存管理和优化策略
- 与其他系统的关联
- 版本变更历史

**定位步骤：**

```
1. 根据功能名确定关键类名
   示例：反射系统 → FProperty, UClass, UObject

2. 在源码中定位这些类
   位置：${unrealEnginePath}/Source/Runtime/CoreUObject/Public/

3. 分析关键函数实现
   查看 .cpp 文件中的具体实现

4. 提取设计模式和优化要点
   记录代码结构、缓存机制、性能优化等
```

**源码位置参考：**

| 功能 | 位置 |
|------|------|
| Slate UI 框架 | Source/Runtime/Slate/Public/Widgets |
| 反射系统 | Source/Runtime/CoreUObject/Public/Misc |
| 属性系统 | Source/Runtime/CoreUObject/Public/Containers |
| Actor 系统 | Source/Runtime/Engine/Public/GameFramework |
| 事件系统 | Source/Runtime/Core/Public/Delegates |
| 资源系统 | Source/Runtime/AssetRegistry/Public |

**预期收获：**
- 完整的实现代码
- 内部数据结构
- 优化策略（缓存、索引等）
- 设计模式
- 性能考量

**评估标准：**
- ✅ 充分：找到关键实现、能提取完整模式
- ⚠️ 部分：找到相关代码但不完整
- ❌ 不足：找不到源码或代码路径不存在

---

## 信息充分性检查清单

### 搜索执行检查

必须确认三层搜索都已执行：

```
搜索层次     | 执行状态 | 质量评估
------------|--------|--------
@UE5 知识库 | [ ]完成 | [ ]充分 [ ]部分 [ ]不足
网络搜索    | [ ]完成 | [ ]充分 [ ]部分 [ ]不足
源码分析    | [ ]完成 | [ ]充分 [ ]部分 [ ]不足
```

**三层都执行了吗？**
- ✅ YES → 继续到信息综合
- ❌ NO → 补充缺失的搜索

### 信息内容检查

确认收集到了**关键信息**：

```
信息维度           | 是否获得
-----------------|--------
官方推荐方案      | [ ]YES [ ]NO
官方 API 文档     | [ ]YES [ ]NO
官方代码示例      | [ ]YES [ ]NO
社区实现方案      | [ ]YES [ ]NO
最新技巧和技巧   | [ ]YES [ ]NO
源码实现细节      | [ ]YES [ ]NO
设计模式分析      | [ ]YES [ ]NO
性能优化要点      | [ ]YES [ ]NO
常见问题和解决   | [ ]YES [ ]NO
版本兼容性说明    | [ ]YES [ ]NO
```

**关键信息是否齐全？**
- ✅ 至少 7 个 YES → 信息充分
- ⚠️ 5-6 个 YES → 信息基本充分
- ❌ < 5 个 YES → 需要补充搜索

### 信息一致性检查

三层搜索的结果是否一致：

```
对比项            | @UE5 | 网络 | 源码 | 是否一致
-----------------|------|------|------|--------
推荐实现方式      |      |      |      | [ ]是 [ ]否
关键类或函数      |      |      |      | [ ]是 [ ]否
性能考量          |      |      |      | [ ]是 [ ]否
最佳实践          |      |      |      | [ ]是 [ ]否
```

**如有不一致：**
- 分析原因（官方更新了、源码版本差异等）
- 选择最合适的方案（通常是官方优先）
- 记录差异原因在注释中

### 编码前最终确认

```
在开始编码前，确认：

[ ] 三层搜索都已执行或有充分理由跳过
[ ] 收集的信息能回答用户的问题
[ ] 理解了官方、社区、源码方案
[ ] 选择的方案是最优的
[ ] 没有遗漏关键的最佳实践
[ ] 能用收集的信息生成完整解决方案
```

**所有项都确认？** → 可以开始编码

---

## 何时可以跳过某层搜索

### 极简问题

**定义：** 问题答案简单明确，无需深入学习

**示例：**
```
@UE5 FVector 如何创建？
答：FVector MyVector(1.0f, 2.0f, 3.0f);
```

**允许：** 跳过第二、三层搜索

### 高度确定问题

**定义：** 已知唯一的、明确的解决方案，无需验证

**示例：**
```
问：UObject 的序列化方式？
已知：使用 Serialize() 虚函数，所有 UObject 都是这样做的
```

**允许：** 跳过第二、三层搜索

### 用户明确指示

**定义：** 用户明确说 "不用查，直接做"

**示例：**
```
用户：我已经知道怎么做了，不用搜，直接帮我实现代码
```

**允许：** 根据用户指示跳过搜索

### 其他所有情况

**必须执行三层搜索。** 包括但不限于：

- 学习实现方式
- 创建新功能
- 优化性能
- 解决问题
- 审视设计
- 参考模式

---

## 搜索结果的使用

### 信息来源优先级（用于决策）

当三层搜索结果不一致时：

| 优先级 | 来源 | 权重 | 说明 |
|--------|------|------|------|
| 1️⃣ | @UE5 官方 | ⭐⭐⭐ | 最权威，推荐优先用 |
| 2️⃣ | 社区验证 | ⭐⭐ | 新且实用，但需验证 |
| 3️⃣ | 源码实现 | ⭐⭐ | 最底层，但可能不是最佳 |

### 代码生成时的融合

生成代码时的融合方式：

```
基础框架 → 用 @UE5 官方 API 和模式
关键实现 → 用源码中的设计模式
性能优化 → 用社区验证的技巧
错误处理 → 用社区讨论的常见问题

最终结果 = 官方框架 + 源码模式 + 社区技巧
```

### 注释和参考

生成的代码中：

```cpp
// [参考来源] @UE5 官方文档
// [官方推荐] FString 应该用 FString::Printf
FString Result = FString::Printf(TEXT("Value: %d"), Value);

// [参考来源] 社区最佳实践
// [优化建议] 使用缓存避免重复计算
if (!CachedValue.IsValid()) {
    CachedValue = ExpensiveCalculation();
}

// [参考来源] Unreal 源码 UObject 实现
// [设计模式] 使用虚函数重写以扩展行为
virtual void PostSerialize(const FArchive& Ar) override;
```

---

## 常见场景的搜索指导

### 场景 1：实现新功能

**问题：** "我想实现一个自定义编辑器面板"

**三层搜索：**

1. **@UE5 搜索：** "Slate SCompoundWidget 自定义编辑器"
   - 获得：Slate API、官方面板示例

2. **网络搜索：** "Unreal Engine custom editor panel tutorial"
   - 获得：教程、实现步骤、常见做法

3. **源码分析：** 查看 SDetailView、SLevelViewport 源码
   - 获得：面板架构、事件处理、布局模式

**充分性检查：** 
- ✅ 有官方 API 和示例
- ✅ 有教程和实现方式
- ✅ 理解了源码面板的架构
→ 信息充分，可以开始编码

### 场景 2：优化性能

**问题：** "游戏加载太慢，如何优化？"

**三层搜索：**

1. **@UE5 搜索：** "Unreal Engine asset loading performance optimization"
   - 获得：官方优化指南、最佳实践

2. **网络搜索：** "Unreal Engine loading performance tips 2024"
   - 获得：最新社区技巧、常见瓶颈、工具使用

3. **源码分析：** 查看 FStreamingManager、FAsyncLoading 源码
   - 获得：底层加载机制、缓存策略、优化点

**充分性检查：**
- ✅ 有官方指南
- ✅ 有社区最新技巧
- ✅ 理解底层加载机制
→ 信息充分，可以制定优化方案

### 场景 3：快速 API 查询

**问题：** "@UE5 FVector::Distance 函数怎么用？"

**三层搜索：**

1. **@UE5 搜索：** "FVector Distance 函数"
   - 获得：函数签名、使用方式、返回值说明

**充分性检查：**
- ✅ 问题极简，官方文档充分
→ 可以跳过第二、三层搜索

---

## 总结

### 改进前后对比

| 方面 | 改进前 | 改进后 |
|------|--------|--------|
| 搜索执行 | 有答案就停止 | 必须全部执行 |
| 信息深度 | 可能不够充分 | 三维度充分覆盖 |
| 解决方案 | 可能遗漏最佳实践 | 融合三层最佳实践 |
| 问题解决 | 可能有遗憾 | 更全面完整 |

### 关键改进点

1. **从单层到三层** - 不再仅依赖一层搜索
2. **从快速到充分** - 确保信息充足再开始编码
3. **从独立到融合** - 充分融合三层信息的优势
4. **从粗糙到精细** - 更详细的检查清单和指导

---

**版本：** 1.0  
**生效日期：** 2025-11-14  
**维护者：** UnrealCodeImitator Skill Team
